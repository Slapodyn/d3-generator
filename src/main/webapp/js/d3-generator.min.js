function generateChartButtonClicked(){$("#generateButtonSection").hide(),window.editorContent!=window.sourceEditor.getSession().getValue()?$("#sourceCodeOverrideAlert").show():doCallCodeGenerator()}function abortCodeGeneration(){$("#sourceCodeOverrideAlert").hide(),$("#generateButtonSection").show()}function doCallCodeGenerator(){$("#sourceCodeOverrideAlert").hide(),callCodeGenerator($("#inputCategoryColumn").val(),$("#inputMeasureColumn").val(),$("input[name=order]:checked").val(),$("#measureOperation").val())}function callCodeGenerator(a,b,c,d){hasOrder=""!==c&&undefined!==c,mixpanel.track("generate_chart",{order:hasOrder,measureOperation:d}),url="/generator/barchart?categoryColumn="+a+"&measureColumn="+b+"&measureOperation="+d,hasOrder&&(url+="&orderColumn="+c),d3.text(url,function(a){window.editorContent=a,$("#chart").empty(),window.sourceEditor.getSession().setValue(a),window.sourceEditor.resize(),redrawChart(),$("#generateButtonSection").show()})}function parseCsv(a){window.data=d3.csv.parse(a),window.jsonEditor.getSession().setValue(JSON.stringify(window.data,undefined,2)),updateChartGeneratorState()}function isNumber(a){return!isNaN(parseFloat(a))&&isFinite(a)}function updateChartGeneratorState(){if(window.data!==undefined&&window.data.length>0){$("#warning-no-columns").hide();var a=_.map(window.data[0],function(a,b){return[a,b]}),b=function(a,b){return a+'<option value="'+b[1]+'">'+b[1]+"</option>"},c=_.filter(a,function(a){return isNumber(a[0])}),d=_.reduce(a,b,""),e=_.reduce(c,b,"");$("#inputCategoryColumn").html(d),$("#inputMeasureColumn").html(e),$("#orderColumn").html('<option value="">no order</option>'+e),$("#inputCategoryColumn").attr("disabled",!1),c.length>0?($("#inputMeasureColumn").attr("disabled",!1),$("#measureOperation").attr("disabled",!1),$("#orderOriginal").attr("disabled",!1),$("#orderValueAscending").attr("disabled",!1),$("#orderValueDescending").attr("disabled",!1),$("#orderLabelAlphabetical").attr("disabled",!1),$("#buttonGenerateCode").removeClass("disabled"),$("#warning-no-numerical-columns").hide()):($("#inputMeasureColumn").attr("disabled",!0),$("#measureOperation").attr("disabled",!0),$("#orderOriginal").attr("disabled",!0),$("#orderValueAscending").attr("disabled",!0),$("#orderValueDescending").attr("disabled",!0),$("#orderLabelAlphabetical").attr("disabled",!0),$("#buttonGenerateCode").addClass("disabled"),$("#warning-no-numerical-columns").show())}else $("#inputCategoryColumn").html(""),$("#inputMeasureColumn").html(""),$("#inputCategoryColumn").attr("disabled",!0),$("#inputMeasureColumn").attr("disabled",!0),$("#measureOperation").attr("disabled",!0),$("#orderOriginal").attr("disabled",!0),$("#orderValueAscending").attr("disabled",!0),$("#orderValueDescending").attr("disabled",!0),$("#orderLabelAlphabetical").attr("disabled",!0),$("#buttonGenerateCode").addClass("disabled"),$("#warning-no-numerical-columns").hide(),$("#warning-no-columns").show()}function redrawChart(){var code=window.sourceEditor.getSession().getValue();if(code==="")return;$("#chart").empty(),$("#chart").show(),$("#emptyChart").hide(),$("#noChartYet").hide(),$("#renderError").hide();try{eval("(function() {\n"+code+"\n}());")}catch(error){$("#chart").hide(),$("#renderError").show(),console.log("error drawing chart"),console.log(error)}finally{}}mixpanel.track("pageload",{URL:window.location.href,"Browser + Version":BrowserDetect.browser+" "+BrowserDetect.version,"Screen Resolution":screen.width+" x "+screen.height}),window.data=[],window.editorContent="",updateChartGeneratorState();var JsonMode=require("ace/mode/json").Mode;window.jsonEditor=ace.edit("jsonEditor"),window.jsonEditor.getSession().setMode(new JsonMode),window.jsonEditor.setReadOnly(!0),window.jsonEditor.setShowPrintMargin(!1),window.jsonEditor.getSession().on("change",redrawChart);var JavascriptMode=require("ace/mode/javascript").Mode;window.sourceEditor=ace.edit("sourceEditor"),window.sourceEditor.getSession().setMode(new JavascriptMode),window.sourceEditor.setShowPrintMargin(!1),window.sourceEditor.getSession().on("change",redrawChart),window.csvEditor=ace.edit("csvEditor"),window.csvEditor.setShowPrintMargin(!1),window.csvEditor.getSession().on("change",function(){parseCsv(window.csvEditor.getSession().getValue()),window.csvEditor.resize()}),window.onResize=function(){window.csvEditor.resize(),window.jsonEditor.resize(),window.sourceEditor.resize()},d3.text("data/countries.csv",function(a){window.csvEditor.getSession().setValue(a)})